name: Generate RSS Feed

on:
  schedule:
    - cron: "0 * * * *" # 매 정시마다 실행 (UTC 기준)
  workflow_dispatch: # 수동 실행도 가능하게
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.21"

      - name: Load .env
        run: |
          echo "REDDIT_CLIENT_ID=${{ secrets.REDDIT_CLIENT_ID }}" >> .env
          echo "REDDIT_CLIENT_SECRET=${{ secrets.REDDIT_CLIENT_SECRET }}" >> .env
          echo "REDDIT_USERNAME=${{ secrets.REDDIT_USERNAME }}" >> .env
          echo "REDDIT_PASSWORD=${{ secrets.REDDIT_PASSWORD }}" >> .env
          echo "REDDIT_USER_AGENT=${{ secrets.REDDIT_USER_AGENT }}" >> .env

      - name: Install dependencies
        run: go mod tidy

      - name: Run RSS Generator
        run: go run main.go

      - name: Commit and Push rss.xml
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add rss.xml
          git commit -m "🔄 자동 생성된 RSS 업데이트"
          git push
